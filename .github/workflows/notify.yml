name: Notificar Status da PR

on:
  pull_request:
    types: [closed]
  pull_request_review:
    types: [submitted]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Enviar notificação para o webhook
        if: github.event.review.state == 'approved' || github.event.pull_request.merged == true
        run: |
          curl -X POST ${{ secrets.WEBHOOK_URL }} \
            -H "Content-Type: application/json" \
            -H "x-github-event: ${{ github.event_name }}" \
            -d '{
              "group": "secrets.group",
              "review": {
                "state": "${{ github.event.review.state || "" }}"
              },
              "pull_request": {
                "title": "${{ github.event.pull_request.title }}",
                "html_url": "${{ github.event.pull_request.html_url }}",
                "user": {
                  "login": "${{ github.event.pull_request.user.login }}"
                },
                "head": {
                  "ref": "${{ github.event.pull_request.head.ref }}"
                },
                "base": {
                  "ref": "${{ github.event.pull_request.base.ref }}"
                },
                "merged": ${{ github.event.pull_request.merged }}
              }
            }'
